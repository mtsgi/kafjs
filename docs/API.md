# APIドキュメント

このページでは、kaf.jsで利用可能な**kafオプション、kaf属性、Kafクラス、kafインスタンス**のAPI(属性そのものや、メソッドなど)について説明します。

## kaf属性

kaf.jsは基本的に**kafコンテナー内の要素**に特定の属性を付与することで機能します。

これらの特定の属性を付与された要素は、kafの機能を持つ要素として**ファクター**に登録されます。

### kit-e属性

**[実装を見る](https://github.com/mtsgi/kafjs/blob/b28c308fe8382c28b993776ac398801077009aa9/kaf.js#L58-L66)**

## kafインスタンス(内部データ)

**kafインスタンス**には、そのインスタンスの持つ**要素やデータ、イベント**などのオプションと、主にそのインスタンス内で利用するための**メソッド群**がインスタンスメソッドとして実装されています。

> kafインスタンスのメソッドは`$`接頭辞から始まります。kafが内部的に使用するデータは`_`接頭辞を持ちます。これらの接頭辞を持つデータやイベントを定義することは非推奨です。

以下の説明では、あるkafインスタンスを`kaf`として説明します。

### kaf._elem

`kaf._elem`は、インスタンスの**kafコンテナー**要素を表すデータです。初期化時に取得され、コンテナーとなる要素が見つからなかった場合**KAFエラー**が発生します。

### kaf._elem_selector

`kaf._elem_selector`は、**kafコンテナー**を得るためのセレクター文字列を表すデータです。初期化時に`elem`オプションに渡された文字列と同一です。

### kaf._factors

`kaf._factors`は、コンテナー内のすべての**kafとしての機能を持つ要素**のNodeListを表すデータです。kaf.jsではこれらをインスタンスのファクターと呼びます。

インスタンス内の要素で、かつ`Kaf.attrs`のいずれかにマッチする要素がすべて該当します。

### kaf._data

`kaf._data`は、**kafデータ**の内容を表すデータです。これは、kaf.jsが内部的にkafデータの内容を管理するためのデータです。通常はこのオブジェクトに対して何らかの変更を加えないでください。

### kaf._data.__locale

`__locale`は特殊な**kafデータ名**で、インスタンスの現在の言語コードを表します。これにより、`kaf.__locale == 'ja'`のような代入によって言語の切り替えを行うことができます。

通常はこのオブジェクトに対して何らかの変更を加えないでください。

### kaf._data.__default_locale

`__default_locale`は特殊な**kafデータ名**で、インスタンスのデフォルトの言語コードを表します。初期化時に`locale`オプションに渡された文字列と同一です。`locale`オプションが渡されなかった場合は、`'default'`という文字列です。

通常はこのオブジェクトに対して何らかの変更を加えないでください。

### kaf._data.__calc

正式リリース前の試験的な機能のために使用されます。

### kaf._calc

正式リリース前の試験的な機能のために使用されます。

### kaf._events

`kaf._events`は、定義された**kafイベント**を表すデータです。初期化時に`events`オプションに渡されたオブジェクトと同一です。

### kaf._styles

`kaf._styles`は、**スタイル制御**のためのスタイル定義を表すデータです。初期化時に`styles`オプションに渡されたオブジェクトと同一です。

### kaf._dictionary

`kaf._dictionary`は、kafで使用する**すべての辞書**を表すデータです。初期化時に`dictionary`オプションに渡されたオブジェクトと同一です。

### kaf._nodenum

ファクターのノード番号を付与するために使用されます。初期化後は、ファクターのノード数を表します。

## kafインスタンス(インスタンスメソッド)

kafインスタンスのメソッドは、コード内で使用することができます。

### kaf.$qs

`kaf.$qs`は**kafコンテナー**内の要素をセレクターを用いて取得するインスタンスメソッドです。

このメソッドは、引数に1個以上のセレクターを指定すると、各セレクターにマッチする要素すべてを含むNodeListを返します。引数を0個渡すと、**kafコンテナー**自体のみを含むNodeListを返します。

```js
kaf.$qs('input'); // コンテナー内のすべてのinput要素を取得
```

**[実装を見る](https://github.com/mtsgi/kafjs/blob/b28c308fe8382c28b993776ac398801077009aa9/kaf.js#L126-L129)**

### kaf.$induce

`kaf.$induce`はkafデータの内容変更に際して、コンテナー内の要素に**変化を誘発**するインスタンスメソッドです。

このメソッドは、kafデータに対する代入が行われる時(例えば、kafデータ`count`が定義されている時、`this.count = 0`あるいは`this.count += 1`のような時)にセッターによって自動的に呼び出されます。

このメソッドが呼び出されることにより**kafデータの変化をファクターに伝え**、要素に何らかの変化をもたらします。

> kafデータの実データは、`kaf._data`オブジェクト内に保持されています。`this.count = 0`のような代入は、内部的にkaf.jsが`kaf._data.count`に対する代入とデータ誘発を行います。これを直接変更した場合は`kaf.$induce`は実行されません。

**[実装を見る](https://github.com/mtsgi/kafjs/blob/b28c308fe8382c28b993776ac398801077009aa9/kaf.js#L131-L162)**

### kaf.$locale

`kaf.$locale`は言語コードの切り替えに際して、コンテナー内の`kit-i`属性を持つ要素の内容を変化させるインスタンスメソッドです。

このメソッドは、`__locale`という名前の**kafデータに対する誘発**が行われる時に自動的に呼び出されます。

> このメソッド内で、言語の辞書にないキーが出現した時、**デフォルトの言語コードの辞書**にそのキーが存在するかチェックし、存在する場合はその単語で置換します。

**[実装を見る](https://github.com/mtsgi/kafjs/blob/b28c308fe8382c28b993776ac398801077009aa9/kaf.js#L164-L170)**

## Kafクラス



